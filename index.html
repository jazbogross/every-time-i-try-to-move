<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>every time I try to move</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
		
<p class="vericaltext">an undefined number of <a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactors</a> in the black box at <a href="https://hautscene.dk/" target="_blank"> YC festival</a>. their phones light up their faces. they enter and leave whenever they want. they improvise their ways in the space together. from a black box in Tunis, a dancer is moving his digital body. microphones are recording the sound of their voices.</p>
<script src="https://player.vimeo.com/api/player.js"></script>    
<div id="text-container">
    <div class="block" id="container">
        <ul data-current="0">
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: where do I begin?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: where do you begin?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: I</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: am</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: in a disrupted state</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: of</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: being</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: breathing</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: moving</p></li>
            <li><p><i>the <a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a> takes a seat. as if they were seated on a warm stone in the early autumn sun, they place their body in a relaxed position, feet apart, arms resting in their lap, relaxed shoulders and face muscles. the <a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a> takes a deep breath in and while they slowly exhale, they turn their head to the right.</i></p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: everytime I try to move</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: I loose track of my destination</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: I loose track of where I came from</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: ruined</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: my body keeps moving</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: in my mind</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: I am moving</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: you are not ruined</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: I am a fragment</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: stay</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: is my body not moving</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: ruins?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: now is not the time to give up on your loved ones</p></li>
            <li><p class="highlighted"><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: moving through time</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: I am a fragment</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: of a</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: we</p></li>
            <li><p class="highlighted"><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: we are</p></li>
            <li><p class="highlighted"><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: unstable</p></li>
            <li><p class="highlighted"><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: connections</p></li>
            <li><p class="highlighted"><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: hearts</p></li> 
            <li><p class="highlighted"><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: beating</p></li> 
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: to the same</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: lost</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: pixels</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: of</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: lungs</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: breathing in</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: not enough cables in this world</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: to carry</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: my</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: warm embrace</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: your skin is</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: reaching</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: I</p></li>
            <li><p><i>the <a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a> takes a seat. as if they were seated on a warm stone in the early autumn sun, they place their body in a relaxed position, feet apart, arms resting in their lap, relaxed shoulders and face muscles. the <a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a> takes a deep breath in and while they slowly exhale, they look straight ahead.</i></p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do I end where my voice ends?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: step into our story</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: where do you begin?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: am I not moving?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: are we not</p></li> 
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: moving</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: through time</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: resonating</p></li> 
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: in</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: the stories</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: of</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: each other</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: are we not</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: where do I begin?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: ruins</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: where do I end?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: where do you end?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do I end in you?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: warm ruins</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do you end in me?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do I end in you?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: embrace a random object</p></li>
            <li><p><i>the <a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a> takes a seat. as if they were seated on a warm stone in the early autumn sun, they place their body in a relaxed position, feet apart, arms resting in their lap, relaxed shoulders and face muscles. the <a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a> takes a deep breath in and while they slowly exhale, they turn their head to the left.</i></p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do I end where my voice ends?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do I begin where my voice ends?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do you begin in me?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do I begin in you?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do you begin in me?</p></li>
            <li><p><a href="https://en.wiktionary.org/wiki/spect-actor" target="_blank">spectactor</a>: do I begin in you?</p></li>
        </ul>
    </div>
</div>

<div id="background"></div>
<div id="vimeo-container"></div>
<canvas id="canvas" style="display: none;"></canvas>
  
<div id="welcome-screen">
  <div><p>every time I try to move</p></div>
  <div><button id="enterPerformance">enter</button></div>
</div>

<script>
const SELECTORS = {
    HTML: 'html',
    CANVAS: '#canvas',
    WELCOME_SCREEN: '#welcome-screen',
    VIMEO_CONTAINER: '#vimeo-container',
    FULLSCREEN_BTN: '#fullscreenBtn',
    ENTER_PERFORMANCE: '#enterPerformance',
    CONTAINER: '#container',
    BACKGROUND: '#background',
    SCRIPT: '#text-container'
};

const VIMEO_ID = '878938745';
const UPDATE_INTERVAL = 2000; // 2 seconds
const INITIAL_RANDOM_NUMBER = 50;
const VIMEO_OPTIONS = {
    id: VIMEO_ID,
    width: window.innerWidth,
    loop: true,
    controls: false,
    autoplay: true,
    muted: true
};

let domSize = { height: window.innerHeight, width: window.innerWidth };
let state = {
    visibleTime: 0,
    randomNumber: INITIAL_RANDOM_NUMBER,
    vimeoVisible: false,
    canvasVisible: true,
    lastTimeUpdate: Date.now(),
    isBuffering: false
};

const elements = {
    html: document.querySelector(SELECTORS.HTML),
    canvas: document.getElementById(SELECTORS.CANVAS.slice(1)),
    welcomeScreen: document.getElementById(SELECTORS.WELCOME_SCREEN.slice(1)),
    vimeoContainer: document.querySelector(SELECTORS.VIMEO_CONTAINER),
    background: document.querySelector(SELECTORS.BACKGROUND),
    script: document.querySelector(SELECTORS.SCRIPT),
    video: document.createElement('video'),
    vimeoPlayer: null // Initialized later
};

// Initialize styles
elements.vimeoContainer.style.display = 'none';
elements.canvas.style.display = 'block';
elements.video.autoplay = true;
elements.video.muted = true;
elements.vimeoPlayer = new Vimeo.Player(elements.vimeoContainer, VIMEO_OPTIONS);

// Event Listeners
document.getElementById(SELECTORS.ENTER_PERFORMANCE.slice(1)).addEventListener('click', setupCamera);
document.getElementById(SELECTORS.CONTAINER.slice(1)).addEventListener('scroll', infinityScroll);

// Function declarations
function setupVimeoPlayer() {
    elements.vimeoPlayer.on('play', () => elements.vimeoContainer.style.display = 'block');
    elements.vimeoPlayer.on('timeupdate', handleTimeUpdate);
}

function handleTimeUpdate() {
    const now = Date.now();
    const timeDiff = now - state.lastTimeUpdate;

    if (timeDiff > UPDATE_INTERVAL) {
        state.isBuffering = !state.isBuffering;
        elements.vimeoContainer.style.display = state.isBuffering ? 'none' : 'block';
    }

    state.lastTimeUpdate = now;
}

async function setupCamera() {
  elements.welcomeScreen.style.display = "none";
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: 'user' },
    });
    elements.video.srcObject = stream;
    elements.video.muted = true; // Mute the video
    elements.video.playsInline = true; // Allows inline playback
    elements.video.addEventListener('loadedmetadata', () => {
    elements.video.play(); // Play video after metadata has loaded
    });

    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    console.log('ctx: ' + ctx);
    const draw = () => {
//    console.log("Draw function called");
      ctx.drawImage(elements.video, 0, 0, canvas.width, canvas.height);
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;
      const threshold = 40;
      const feather = 50;

      for (let i = 0; i < data.length; i += 4) {
        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;

        if (brightness < threshold) {
          data[i + 3] = 0;
        } else if (brightness < threshold + feather) {
          data[i + 3] = 255 * ((brightness - threshold) / feather);
        }
      }

      ctx.putImageData(imageData, 0, 0);
      requestAnimationFrame(draw);
    };

    draw();
    hideWelcome();
  } catch (err) {
    console.error("An error occurred: ", err);
  }
}

function infinityScroll(event) {
  document.addEventListener( "DOMContentLoaded", function() {
    console.log('DOM Content loaded. Yayyyyy')
    var div = document.getElementById( "container" );
    div.addEventListener( "scroll", function() {
        console.log('You are scrolling!')
        var max_scroll = this.scrollHeight - this.clientHeight;
        var current_scroll = this.scrollTop;
        var bottom = 100;
            if ( current_scroll + bottom >= max_scroll ) {
                var ul = document.getElementsByTagName( "ul" )[ 0 ];
                var current = parseInt( ul.dataset.current, 10 );
                var li = document.getElementsByTagName( "li" )[ current ];
                var new_li = li.cloneNode( true );
                ul.appendChild( new_li );
                ul.dataset.current = current + 1; 
            }
        });
    });	
}

const turnOffLights = (minuteToRun) => {
  setInterval(() => {
    const date = new Date();
    if (date.getMinutes() === minuteToRun && date.getSeconds() === 0) {
      console.log(`Triggered at ${date}`);


    elements.background.style.transition = 'all 1s ease';
    elements.background.style.filter = 'brightness(100%)';
    elements.background.style.filter = 'brightness(0%)';
    elements.background.style.zIndex = '999';
    console.log('background darkened');
    


    }
  }, 1000);
};

const turnOnLights = (minuteToRun) => {
  setInterval(() => {
    const date = new Date();
    if (date.getMinutes() === minuteToRun && date.getSeconds() === 0) {
      console.log(`Triggered at ${date}`);

      const highlightedElements = document.querySelectorAll('.highlighted');
      console.log(highlightedElements);
      highlightedElements.forEach((element, index) => {
        // Delay for each element of 1 minute
        setTimeout(() => {
          // Set the transition for color change
          element.style.transition = 'color 2s ease';
          //Move script in front of BG
         elements.script.style.zIndex = '1000';
        // element.style.filter = 'brightness(100%)';
         // console.log("MADE HIGHLIGHTED WORD BRIGHT");
         
          element.scrollIntoView({ behavior: 'smooth', block: 'center' });
          console.log("SCROLLED TO WORD");
          
          // Initially set color to black
          element.style.color = '#000000';
          console.log("changed to BLACK");

          // Change color to white after a brief moment
          setTimeout(() => {
            element.style.color = '#FFFFFF';
            console.log("changed to WHITE");
          }, 10); // A brief delay to ensure the transition takes effect
        }, 60000 * index); // 1 minute apart for each element
              // After all elements have changed, set zIndex
      const totalDuration = 60000 * highlightedElements.length + 2000; // Total time + 2 seconds for the last transition
      setTimeout(() => {
        if (elements.background) {
          elements.background.style.zIndex = '-1';
          elements.background.style.filter = 'brightness(100%)';
          highlightedElements.forEach((element, index) => {
            element.style.color = '#000000';
          });
        }
      }, totalDuration);
      });
    }
  }, 1000);
};


const showVimeo = (x) => {
  setInterval(() => {
    const random100 = Math.random() * 100;
   // console.log(random100);
    if (state.randomNumber > random100 && !state.vimeoVisible) {
      
      setupVimeoPlayer();
      elements.vimeoPlayer.loadVideo(VIMEO_ID).then(() => {
        hideControls();
        elements.vimeoPlayer.setVolume(0); // Assuming you still want it muted
        elements.vimeoPlayer.play();
        elements.vimeoContainer.style.display = 'block';
        state.vimeoVisible = true;
        chancePercentage();
      //  console.log(state.randomNumber);
      }).catch(error => {
        console.error("Error loading Vimeo video:", error);
      });
    } else {
   //   console.log(`showVimeo function did not run. Random number ${random100.toFixed(2)} is greater than ${state.randomNumber} or it was already playing`);
    }
  }, x * 1000);
};

const showFace = (x) => {
  setInterval(() => {
    const random100 = Math.random() * 100;
    chancePercentage();
    if (state.randomNumber > random100 && state.canvasVisible == false) {
        elements.canvas.style.display = 'block';
        console.log("Canvas Initialized");
        console.log('stream: ' + elements.video.srcObject);
        state.canvasVisible = true
    } else {
    //  console.log(`showFace function did not run. Random number ${random100.toFixed(2)} is greater than ${state.randomNumber} OR it was already visible`);
    }
  }, x * 1000);
};

const hideVideos = (x) => {
  setInterval(() => {
    if (state.vimeoVisible || state.canvasVisible) {
      state.visibleTime += x;
      let logProb;
        if (state.visibleTime <= 60) {
            // Slowly rising probability in the first minute
            logProb = 0.05 * state.visibleTime;
        } else if (state.visibleTime <= 240) {
            // Faster rise in probability from 5% to 100% between 1 and 4 minutes
            logProb = 5 + 30 * ((state.visibleTime - 60) / (240 - 60));
        } else {
            // 100% probability after 4 minutes
            logProb = 100;
        }

      const chanceOfOff = Math.random() * 100;
   //   console.log('visible time ' + state.visibleTime);

      if (logProb > chanceOfOff) {
        elements.canvas.style.display = 'none';
        elements.vimeoPlayer.unload().then(() => {
          elements.vimeoContainer.style.display = 'none';
          state.vimeoVisible = false;
          state.canvasVisible = false;
          state.visibleTime = 0;
    //      console.log(`hid the videos`);
        }).catch(error => {
          console.error("Error unloading Vimeo video:", error);
        });
      } else {
    //    console.log(`Video(s) running but didn't hide`);
      }
    } else {
   //   console.log(`No videos are running`);
      state.visibleTime = 0;
    }
  }, x * 1000);
};

function hideControls() {
    elements.vimeoPlayer.getPaused().then(function(paused) {
        if (!paused) {
            elements.vimeoPlayer.unload().then(function() {
                elements.vimeoPlayer.loadVideo(vimeoID).then(function(id) {
                    elements.vimeoPlayer.setVolume(0);
                    elements.vimeoPlayer.setControls(false);
                    elements.vimeoPlayer.play();
                });
            });
        }
    });
}

const chancePercentage = () => {
  state.randomNumber = Math.floor(Math.random() * 51) + 50;
};


function hideWelcome() {
  elements.welcomeScreen.style.display = 'none';
  elements.canvas.style.display = 'none';
  elements.vimeoContainer.style.display = 'none';
  state.vimeoVisible = false;
  state.canvasVisible = false;
  state.visibleTime = 0;
}

// Initialize
infinityScroll();
showVimeo(7);
showFace(3);
hideVideos(5);
turnOffLights(56);
turnOnLights(57);




</script>

</body>
</html>
